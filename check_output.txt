    Checking sunbay-softpos-backend v0.1.0 (/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend)
error: 7 positional arguments in format string, but there are 6 arguments
   --> src/services/health_check.rs:128:14
    |
128 |             "{}:{}:{}:{}:{}:{}:{}",
    |              ^^ ^^ ^^ ^^ ^^ ^^ ^^
129 |             request.device_id,
    |             -----------------
130 |             request.root_detection,
    |             ----------------------
131 |             request.emulator_detection,
    |             --------------------------
132 |             request.debugger_detection,
    |             --------------------------
133 |             request.hook_detection,
    |             ----------------------
134 |             request.tampering_detection
    |             ---------------------------

error[E0433]: failed to resolve: use of unresolved module or unlinked crate `futures`
 --> src/api/websocket/connection.rs:8:5
  |
8 | use futures::{sink::SinkExt, stream::StreamExt};
  |     ^^^^^^^ use of unresolved module or unlinked crate `futures`
  |
  = help: if you wanted to use a crate named `futures`, use `cargo add futures` to add it to your `Cargo.toml`

error[E0432]: unresolved import `crate::dto::HealthCheckListResponse`
 --> src/services/health_check.rs:3:50
  |
3 |         HealthCheckRequest, HealthCheckResponse, HealthCheckListResponse,
  |                                                  ^^^^^^^^^^^^^^^^^^^^^^^
  |                                                  |
  |                                                  no `HealthCheckListResponse` in `dto`
  |                                                  help: a similar name exists in the module: `HealthCheckResponse`

error[E0432]: unresolved imports `crate::dto::ThreatResponse`, `crate::dto::ThreatListResponse`
 --> src/services/threat_detection.rs:2:11
  |
2 |     dto::{ThreatResponse, ThreatListResponse, ThreatStatisticsResponse},
  |           ^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^
  |           |               |
  |           |               no `ThreatListResponse` in `dto`
  |           |               help: a similar name exists in the module: `DeviceListResponse`
  |           no `ThreatResponse` in `dto`

error[E0432]: unresolved imports `crate::dto::CreateVersionResponse`, `crate::dto::UpdateVersionRequest`
 --> src/services/version.rs:3:31
  |
3 |         CreateVersionRequest, CreateVersionResponse, VersionResponse, VersionListResponse,
  |                               ^^^^^^^^^^^^^^^^^^^^^ no `CreateVersionResponse` in `dto`
4 |         UpdateVersionRequest,
  |         ^^^^^^^^^^^^^^^^^^^^ no `UpdateVersionRequest` in `dto`
  |
help: a similar name exists in the module
  |
3 -         CreateVersionRequest, CreateVersionResponse, VersionResponse, VersionListResponse,
3 +         CreateVersionRequest, CreateVersionRequest, VersionResponse, VersionListResponse,
  |
help: a similar name exists in the module
  |
4 -         UpdateVersionRequest,
4 +         CreateVersionRequest,
  |

error[E0412]: cannot find type `UpdateVersionRequest` in this scope
   --> src/api/handlers/version.rs:95:21
    |
 95 |     Json(req): Json<UpdateVersionRequest>,
    |                     ^^^^^^^^^^^^^^^^^^^^
    |
   ::: src/dto/request.rs:240:1
    |
240 | pub struct CreateVersionRequest {
    | ------------------------------- similarly named struct `CreateVersionRequest` defined here
    |
help: a struct with a similar name exists
    |
 95 -     Json(req): Json<UpdateVersionRequest>,
 95 +     Json(req): Json<CreateVersionRequest>,
    |
help: you might be missing a type parameter
    |
 91 | pub async fn update_version<UpdateVersionRequest>(
    |                            ++++++++++++++++++++++

error[E0412]: cannot find type `CreatePushTaskRequest` in this scope
   --> src/api/handlers/version.rs:139:21
    |
139 |     Json(req): Json<CreatePushTaskRequest>,
    |                     ^^^^^^^^^^^^^^^^^^^^^ not found in this scope
    |
help: you might be missing a type parameter
    |
136 | pub async fn create_push_task<CreatePushTaskRequest>(
    |                              +++++++++++++++++++++++

warning: unused imports: `DeviceListResponse`, `DeviceResponse`, and `RegisterDeviceResponse`
  --> src/api/handlers/device.rs:13:20
   |
13 |         response::{DeviceListResponse, DeviceResponse, RegisterDeviceResponse},
   |                    ^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: unused imports: `HealthCheckResponse` and `HealthOverviewResponse`
  --> src/api/handlers/health.rs:13:20
   |
13 |         response::{HealthCheckResponse, HealthOverviewResponse},
   |                    ^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^

warning: unused imports: `InjectKeyResponse`, `KeyStatusResponse`, and `UpdateKeyResponse`
  --> src/api/handlers/key.rs:12:20
   |
12 |         response::{InjectKeyResponse, KeyStatusResponse, UpdateKeyResponse},
   |                    ^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^

warning: unused imports: `AttestTransactionResponse` and `ProcessTransactionResponse`
  --> src/api/handlers/transaction.rs:13:20
   |
13 |         response::{AttestTransactionResponse, ProcessTransactionResponse},
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: unused import: `response::VersionResponse`
  --> src/api/handlers/version.rs:13:9
   |
13 |         response::VersionResponse,
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^

warning: unused import: `http::StatusCode`
 --> src/api/middleware/auth.rs:3:5
  |
3 |     http::StatusCode,
  |     ^^^^^^^^^^^^^^^^

warning: unused imports: `IntoResponse`, `body::Body`, and `http::StatusCode`
 --> src/api/middleware/logging.rs:2:5
  |
2 |     body::Body,
  |     ^^^^^^^^^^
3 |     extract::{ConnectInfo, Request},
4 |     http::StatusCode,
  |     ^^^^^^^^^^^^^^^^
5 |     middleware::Next,
6 |     response::{IntoResponse, Response},
  |                ^^^^^^^^^^^^

warning: unused import: `State`
 --> src/api/middleware/prometheus.rs:2:37
  |
2 |     extract::{ConnectInfo, Request, State},
  |                                     ^^^^^

warning: unused import: `std::time::Duration`
 --> src/infrastructure/redis.rs:2:5
  |
2 | use std::time::Duration;
  |     ^^^^^^^^^^^^^^^^^^^

warning: unused imports: `DateTime` and `Utc`
 --> src/models/device.rs:1:14
  |
1 | use chrono::{DateTime, Utc};
  |              ^^^^^^^^  ^^^

warning: unused import: `uuid::Uuid`
 --> src/models/device.rs:4:5
  |
4 | use uuid::Uuid;
  |     ^^^^^^^^^^

warning: unused import: `self`
 --> src/security/crypto.rs:5:23
  |
5 | use ring::signature::{self, UnparsedPublicKey, RSA_PKCS1_2048_8192_SHA256};
  |                       ^^^^

warning: unused import: `RecommendedAction`
 --> src/services/health_check.rs:6:27
  |
6 |     models::{HealthCheck, RecommendedAction, ThreatEvent, ThreatType, ThreatSeverity, DeviceStatus},
  |                           ^^^^^^^^^^^^^^^^^

warning: unused import: `Device`
 --> src/services/key_management.rs:6:14
  |
6 |     models::{Device, DeviceStatus, AuditLog, OperationResult},
  |              ^^^^^^

warning: use of deprecated function `base64::encode`: Use Engine::encode
  --> src/security/crypto.rs:48:16
   |
48 |     Ok(base64::encode(data).into_bytes())
   |                ^^^^^^
   |
   = note: `#[warn(deprecated)]` on by default

warning: use of deprecated function `base64::encode`: Use Engine::encode
  --> src/security/crypto.rs:80:13
   |
80 |     base64::encode(data)
   |             ^^^^^^

warning: use of deprecated function `base64::decode`: Use Engine::decode
  --> src/security/crypto.rs:85:13
   |
85 |     base64::decode(data)
   |             ^^^^^^

error[E0061]: this method takes 8 arguments but 6 arguments were supplied
   --> src/api/handlers/audit.rs:34:10
    |
 34 |           .list_logs(
    |  __________^^^^^^^^^-
 35 | |             query.device_id.as_deref(),
 36 | |             query.operation_type.as_deref(),
 37 | |             query.start_time.as_deref(),
 38 | |             query.end_time.as_deref(),
    | |             ------------------------- argument #4 of type `std::option::Option<OperationResult>` is missing
 39 | |             query.page.unwrap_or(1),
 40 | |             query.page_size.unwrap_or(20),
 41 | |         )
    | |_________- argument #7 of type `i64` is missing
    |
note: expected `Option<&str>`, found `i64`
   --> src/api/handlers/audit.rs:39:13
    |
 39 |             query.page.unwrap_or(1),
    |             ^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<&str>`
               found type `i64`
note: method defined here
   --> src/services/audit.rs:125:18
    |
125 |     pub async fn list_logs(
    |                  ^^^^^^^^^
...
130 |         result: Option<OperationResult>,
    |         -------------------------------
131 |         start_time: Option<&str>,
132 |         end_time: Option<&str>,
    |         ----------------------
133 |         limit: i64,
    |         ----------
help: provide the arguments
    |
 34 ~         .list_logs(
 35 +             query.device_id.as_deref(),
 36 +             query.operation_type.as_deref(),
 37 +             query.start_time.as_deref(),
 38 +             /* std::option::Option<OperationResult> */,
 39 +             query.end_time.as_deref(),
 40 +             /* std::option::Option<&str> */,
 41 +             /* i64 */,
 42 +             query.page_size.unwrap_or(20),
 43 +         )
    |

error[E0061]: this method takes 8 arguments but 6 arguments were supplied
   --> src/api/handlers/audit.rs:71:10
    |
 71 |           .list_logs(
    |  __________^^^^^^^^^-
 72 | |             Some(&device_id),
 73 | |             query.operation_type.as_deref(),
 74 | |             query.start_time.as_deref(),
 75 | |             query.end_time.as_deref(),
    | |             ------------------------- argument #4 of type `std::option::Option<OperationResult>` is missing
 76 | |             query.page.unwrap_or(1),
 77 | |             query.page_size.unwrap_or(20),
 78 | |         )
    | |_________- argument #7 of type `i64` is missing
    |
note: expected `Option<&str>`, found `i64`
   --> src/api/handlers/audit.rs:76:13
    |
 76 |             query.page.unwrap_or(1),
    |             ^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<&str>`
               found type `i64`
note: method defined here
   --> src/services/audit.rs:125:18
    |
125 |     pub async fn list_logs(
    |                  ^^^^^^^^^
...
130 |         result: Option<OperationResult>,
    |         -------------------------------
131 |         start_time: Option<&str>,
132 |         end_time: Option<&str>,
    |         ----------------------
133 |         limit: i64,
    |         ----------
help: provide the arguments
    |
 71 ~         .list_logs(
 72 +             Some(&device_id),
 73 +             query.operation_type.as_deref(),
 74 +             query.start_time.as_deref(),
 75 +             /* std::option::Option<OperationResult> */,
 76 +             query.end_time.as_deref(),
 77 +             /* std::option::Option<&str> */,
 78 +             /* i64 */,
 79 +             query.page_size.unwrap_or(20),
 80 +         )
    |

error[E0061]: this method takes 8 arguments but 6 arguments were supplied
   --> src/api/handlers/audit.rs:96:10
    |
 96 |           .list_logs(
    |  __________^^^^^^^^^-
 97 | |             query.device_id.as_deref(),
 98 | |             query.operation_type.as_deref(),
 99 | |             query.start_time.as_deref(),
100 | |             query.end_time.as_deref(),
    | |             ------------------------- argument #4 of type `std::option::Option<OperationResult>` is missing
101 | |             query.page.unwrap_or(1),
102 | |             query.page_size.unwrap_or(20),
103 | |         )
    | |_________- argument #7 of type `i64` is missing
    |
note: expected `Option<&str>`, found `i64`
   --> src/api/handlers/audit.rs:101:13
    |
101 |             query.page.unwrap_or(1),
    |             ^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<&str>`
               found type `i64`
note: method defined here
   --> src/services/audit.rs:125:18
    |
125 |     pub async fn list_logs(
    |                  ^^^^^^^^^
...
130 |         result: Option<OperationResult>,
    |         -------------------------------
131 |         start_time: Option<&str>,
132 |         end_time: Option<&str>,
    |         ----------------------
133 |         limit: i64,
    |         ----------
help: provide the arguments
    |
 96 ~         .list_logs(
 97 +             query.device_id.as_deref(),
 98 +             query.operation_type.as_deref(),
 99 +             query.start_time.as_deref(),
100 +             /* std::option::Option<OperationResult> */,
101 +             query.end_time.as_deref(),
102 +             /* std::option::Option<&str> */,
103 +             /* i64 */,
104 +             query.page_size.unwrap_or(20),
105 +         )
    |

warning: unused variable: `state`
   --> src/api/handlers/audit.rs:114:11
    |
114 |     State(state): State<Arc<AppState>>,
    |           ^^^^^ help: if this is intentional, prefix it with an underscore: `_state`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

error[E0061]: this method takes 8 arguments but 6 arguments were supplied
   --> src/api/handlers/audit.rs:146:10
    |
146 |           .list_logs(
    |  __________^^^^^^^^^-
147 | |             query.device_id.as_deref(),
148 | |             query.operation_type.as_deref(),
149 | |             query.start_time.as_deref(),
150 | |             query.end_time.as_deref(),
    | |             ------------------------- argument #4 of type `std::option::Option<OperationResult>` is missing
151 | |             1,
152 | |             10000, // 导出时获取更多记录
153 | |         )
    | |_________- argument #7 of type `i64` is missing
    |
note: expected `Option<&str>`, found integer
   --> src/api/handlers/audit.rs:151:13
    |
151 |             1,
    |             ^
    = note: expected enum `std::option::Option<&str>`
               found type `{integer}`
note: method defined here
   --> src/services/audit.rs:125:18
    |
125 |     pub async fn list_logs(
    |                  ^^^^^^^^^
...
130 |         result: Option<OperationResult>,
    |         -------------------------------
131 |         start_time: Option<&str>,
132 |         end_time: Option<&str>,
    |         ----------------------
133 |         limit: i64,
    |         ----------
help: provide the arguments
    |
146 ~         .list_logs(
147 +             query.device_id.as_deref(),
148 +             query.operation_type.as_deref(),
149 +             query.start_time.as_deref(),
150 +             /* std::option::Option<OperationResult> */,
151 +             query.end_time.as_deref(),
152 +             /* std::option::Option<&str> */,
153 +             /* i64 */,
154 +             10000,
155 +         )
    |

error[E0308]: arguments to this method are incorrect
  --> src/api/handlers/auth.rs:71:10
   |
71 |         .log_operation(
   |          ^^^^^^^^^^^^^
72 |             &user_id,
   |             -------- expected `String`, found `&String`
73 |             "USER_LOGIN",
   |             ------------ expected `String`, found `&str`
74 |             "User logged in successfully",
   |             ----------------------------- expected `OperationResult`, found `&str`
   |
note: expected `Option<String>`, found `Value`
  --> src/api/handlers/auth.rs:75:13
   |
75 | /             serde_json::json!({
76 | |                 "username": username,
77 | |                 "role": role,
78 | |             }),
   | |______________^
   = note: expected enum `std::option::Option<std::string::String>`
              found enum `serde_json::Value`
note: expected `Option<String>`, found `&str`
  --> src/api/handlers/auth.rs:79:13
   |
79 |             "SUCCESS",
   |             ^^^^^^^^^
   = note:   expected enum `std::option::Option<std::string::String>`
           found reference `&'static str`
note: method defined here
  --> src/services/audit.rs:21:18
   |
21 |     pub async fn log_operation(
   |                  ^^^^^^^^^^^^^
22 |         &self,
23 |         operation_type: String,
   |         ----------------------
24 |         operator: String,
   |         ----------------
25 |         result: OperationResult,
   |         -----------------------
26 |         device_id: Option<String>,
   |         -------------------------
27 |         details: Option<String>,
   |         -----------------------
help: consider removing the borrow
   |
72 -             &user_id,
72 +             user_id,
   |
help: try using a conversion method
   |
73 |             "USER_LOGIN".to_string(),
   |                         ++++++++++++

error[E0308]: arguments to this method are incorrect
   --> src/api/handlers/auth.rs:116:14
    |
116 |             .log_operation(
    |              ^^^^^^^^^^^^^
117 |                 &claims.sub,
    |                 ----------- expected `String`, found `&String`
118 |                 "TOKEN_REFRESH",
    |                 --------------- expected `String`, found `&str`
119 |                 "Token refreshed successfully",
    |                 ------------------------------ expected `OperationResult`, found `&str`
    |
note: expected `Option<String>`, found `Value`
   --> src/api/handlers/auth.rs:120:17
    |
120 | /                 serde_json::json!({
121 | |                     "username": claims.username,
122 | |                 }),
    | |__________________^
    = note: expected enum `std::option::Option<std::string::String>`
               found enum `serde_json::Value`
note: expected `Option<String>`, found `&str`
   --> src/api/handlers/auth.rs:123:17
    |
123 |                 "SUCCESS",
    |                 ^^^^^^^^^
    = note:   expected enum `std::option::Option<std::string::String>`
            found reference `&'static str`
note: method defined here
   --> src/services/audit.rs:21:18
    |
 21 |     pub async fn log_operation(
    |                  ^^^^^^^^^^^^^
 22 |         &self,
 23 |         operation_type: String,
    |         ----------------------
 24 |         operator: String,
    |         ----------------
 25 |         result: OperationResult,
    |         -----------------------
 26 |         device_id: Option<String>,
    |         -------------------------
 27 |         details: Option<String>,
    |         -----------------------
help: consider removing the borrow
    |
117 -                 &claims.sub,
117 +                 claims.sub,
    |
help: try using a conversion method
    |
118 |                 "TOKEN_REFRESH".to_string(),
    |                                ++++++++++++

error[E0308]: arguments to this method are incorrect
   --> src/api/handlers/auth.rs:153:10
    |
153 |         .log_operation(
    |          ^^^^^^^^^^^^^
154 |             &claims.sub,
    |             ----------- expected `String`, found `&String`
155 |             "USER_LOGOUT",
    |             ------------- expected `String`, found `&str`
156 |             "User logged out successfully",
    |             ------------------------------ expected `OperationResult`, found `&str`
    |
note: expected `Option<String>`, found `Value`
   --> src/api/handlers/auth.rs:157:13
    |
157 | /             serde_json::json!({
158 | |                 "username": claims.username,
159 | |             }),
    | |______________^
    = note: expected enum `std::option::Option<std::string::String>`
               found enum `serde_json::Value`
note: expected `Option<String>`, found `&str`
   --> src/api/handlers/auth.rs:160:13
    |
160 |             "SUCCESS",
    |             ^^^^^^^^^
    = note:   expected enum `std::option::Option<std::string::String>`
            found reference `&'static str`
note: method defined here
   --> src/services/audit.rs:21:18
    |
 21 |     pub async fn log_operation(
    |                  ^^^^^^^^^^^^^
 22 |         &self,
 23 |         operation_type: String,
    |         ----------------------
 24 |         operator: String,
    |         ----------------
 25 |         result: OperationResult,
    |         -----------------------
 26 |         device_id: Option<String>,
    |         -------------------------
 27 |         details: Option<String>,
    |         -----------------------
help: consider removing the borrow
    |
154 -             &claims.sub,
154 +             claims.sub,
    |
help: try using a conversion method
    |
155 |             "USER_LOGOUT".to_string(),
    |                          ++++++++++++

error[E0061]: this method takes 4 arguments but 6 arguments were supplied
   --> src/api/handlers/device.rs:60:10
    |
 60 |         .list_devices(
    |          ^^^^^^^^^^^^
...
 63 |             query.sort_by,
    |             ------------- unexpected argument #3 of type `std::option::Option<std::string::String>`
 64 |             query.sort_order,
    |             ---------------- unexpected argument #4 of type `std::option::Option<std::string::String>`
    |
note: expected `Option<&str>`, found `Option<String>`
   --> src/api/handlers/device.rs:62:13
    |
 62 |             query.search,
    |             ^^^^^^^^^^^^
    = note: expected enum `std::option::Option<&str>`
               found enum `std::option::Option<std::string::String>`
note: method defined here
   --> src/services/device.rs:201:18
    |
201 |     pub async fn list_devices(
    |                  ^^^^^^^^^^^^
...
204 |         search: Option<&str>,
    |         --------------------
help: try using `.as_deref()` to convert `std::option::Option<std::string::String>` to `std::option::Option<&str>`
    |
 62 |             query.search.as_deref(),
    |                         +++++++++++
help: remove the extra arguments
    |
 62 -             query.search,
 62 +             /* std::option::Option<&str> */,
    |

error[E0061]: this method takes 1 argument but 2 arguments were supplied
   --> src/api/handlers/device.rs:101:10
    |
101 |         .approve_device(req, &operator_id)
    |          ^^^^^^^^^^^^^^      ------------ unexpected argument #2 of type `&std::string::String`
    |
note: method defined here
   --> src/services/device.rs:98:18
    |
 98 |     pub async fn approve_device(
    |                  ^^^^^^^^^^^^^^
help: remove the extra argument
    |
101 -         .approve_device(req, &operator_id)
101 +         .approve_device(req)
    |

error[E0061]: this method takes 1 argument but 2 arguments were supplied
   --> src/api/handlers/device.rs:122:10
    |
122 |         .reject_device(req, &operator_id)
    |          ^^^^^^^^^^^^^      ------------ unexpected argument #2 of type `&std::string::String`
    |
note: method defined here
   --> src/services/device.rs:143:18
    |
143 |     pub async fn reject_device(
    |                  ^^^^^^^^^^^^^
help: remove the extra argument
    |
122 -         .reject_device(req, &operator_id)
122 +         .reject_device(req)
    |

error[E0061]: this method takes 3 arguments but 2 arguments were supplied
   --> src/api/handlers/device.rs:142:10
    |
142 |         .suspend_device(&device_id, &operator_id)
    |          ^^^^^^^^^^^^^^-------------------------- argument #3 of type `&str` is missing
    |
note: method defined here
   --> src/services/device.rs:232:18
    |
232 |     pub async fn suspend_device(
    |                  ^^^^^^^^^^^^^^
...
236 |         reason: &str,
    |         ------------
help: provide the argument
    |
142 |         .suspend_device(&device_id, &operator_id, /* &str */)
    |                                                 ++++++++++++

error[E0061]: this method takes 3 arguments but 2 arguments were supplied
   --> src/api/handlers/device.rs:204:10
    |
204 |         .revoke_device(&device_id, &operator_id)
    |          ^^^^^^^^^^^^^-------------------------- argument #3 of type `&str` is missing
    |
note: method defined here
   --> src/services/device.rs:317:18
    |
317 |     pub async fn revoke_device(
    |                  ^^^^^^^^^^^^^
...
321 |         reason: &str,
    |         ------------
help: provide the argument
    |
204 |         .revoke_device(&device_id, &operator_id, /* &str */)
    |                                                ++++++++++++

error[E0277]: the trait bound `(axum::http::StatusCode, axum::Json<DeviceStatistics>): IntoResponse` is not satisfied
   --> src/api/handlers/device.rs:226:42
    |
226 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
227 | |     // 调用服务层
228 | |     let stats = state.device_service.get_device_statistics().await?;
...   |
231 | | }
    | |_^ the trait `IntoResponse` is not implemented for `(axum::http::StatusCode, axum::Json<DeviceStatistics>)`
    |
    = help: the following other types implement trait `IntoResponse`:
              ()
              (R,)
              (T1, R)
              (T1, T2, R)
              (T1, T2, T3, R)
              (T1, T2, T3, T4, R)
              (T1, T2, T3, T4, T5, R)
              (T1, T2, T3, T4, T5, T6, R)
            and 61 others
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-14221557815994642509.txt'
    = note: consider using `--verbose` to print the full type name to the console

error[E0277]: the trait bound `(axum::http::StatusCode, axum::Json<DeviceStatistics>): IntoResponse` is not satisfied
   --> src/api/handlers/device.rs:226:13
    |
226 | ) -> Result<impl IntoResponse, AppError> {
    |             ^^^^^^^^^^^^^^^^^ the trait `IntoResponse` is not implemented for `(axum::http::StatusCode, axum::Json<DeviceStatistics>)`
    |
    = help: the following other types implement trait `IntoResponse`:
              ()
              (R,)
              (T1, R)
              (T1, T2, R)
              (T1, T2, T3, R)
              (T1, T2, T3, T4, R)
              (T1, T2, T3, T4, T5, R)
              (T1, T2, T3, T4, T5, T6, R)
            and 61 others
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-14221557815994642509.txt'
    = note: consider using `--verbose` to print the full type name to the console

error[E0061]: this method takes 2 arguments but 1 argument was supplied
  --> src/api/handlers/health.rs:38:47
   |
38 |     let response = state.health_check_service.submit_health_check(req).await?;
   |                                               ^^^^^^^^^^^^^^^^^^^----- argument #2 of type `&str` is missing
   |
note: method defined here
  --> src/services/health_check.rs:38:18
   |
38 |     pub async fn submit_health_check(
   |                  ^^^^^^^^^^^^^^^^^^^
...
41 |         operator: &str,
   |         --------------
help: provide the argument
   |
38 |     let response = state.health_check_service.submit_health_check(req, /* &str */).await?;
   |                                                                      ++++++++++++

warning: this function depends on never type fallback being `()`
  --> src/api/handlers/health.rs:62:1
   |
62 | / pub async fn list_health_checks(
63 | |     State(state): State<Arc<AppState>>,
64 | |     Query(query): Query<ListHealthChecksQuery>,
65 | | ) -> Result<impl IntoResponse, AppError> {
   | |________________________________________^
   |
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
   = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
   = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
  --> src/api/handlers/health.rs:65:42
   |
65 |   ) -> Result<impl IntoResponse, AppError> {
   |  __________________________________________^
66 | |     // 调用服务层
67 | |     let response = state
68 | |         .health_check_service
...  |
78 | |     Ok((StatusCode::OK, Json(response)))
79 | | }
   | |_^
   = note: `#[warn(dependency_on_unit_never_type_fallback)]` (part of `#[warn(rust_2024_compatibility)]`) on by default
help: use `()` annotations to avoid fallback changes
   |
67 |     let response: () = state
   |                 ++++

warning: unused variable: `e`
   --> src/api/handlers/health.rs:121:19
    |
121 |         .map_err(|e| AppError::ServiceUnavailable)?;
    |                   ^ help: if this is intentional, prefix it with an underscore: `_e`

warning: unused variable: `state`
   --> src/api/handlers/health.rs:164:11
    |
164 |     State(state): State<Arc<AppState>>,
    |           ^^^^^ help: if this is intentional, prefix it with an underscore: `_state`

warning: unused variable: `device_id`
  --> src/api/handlers/key.rs:58:10
   |
58 |     Path(device_id): Path<String>,
   |          ^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_device_id`

error[E0061]: this method takes 2 arguments but 1 argument was supplied
   --> src/api/handlers/key.rs:84:10
    |
 84 |         .encrypt_pin(req)
    |          ^^^^^^^^^^^----- argument #2 of type `&str` is missing
    |
note: method defined here
   --> src/services/key_management.rs:245:18
    |
245 |     pub async fn encrypt_pin(
    |                  ^^^^^^^^^^^
...
248 |         operator: &str,
    |         --------------
help: provide the argument
    |
 84 |         .encrypt_pin(req, /* &str */)
    |                         ++++++++++++

error[E0599]: no method named `attest_pinpad_device` found for struct `Arc<DeviceService>` in the current scope
   --> src/api/handlers/pinpad.rs:33:41
    |
 33 |     let response = state.device_service.attest_pinpad_device(req).await?;
    |                                         ^^^^^^^^^^^^^^^^^^^^
    |
help: there is a method `suspend_device` with a similar name, but with different arguments
   --> src/services/device.rs:232:5
    |
232 | /     pub async fn suspend_device(
233 | |         &self,
234 | |         device_id: &str,
235 | |         operator: &str,
236 | |         reason: &str,
237 | |     ) -> Result<(), AppError> {
    | |_____________________________^

warning: this function depends on never type fallback being `()`
  --> src/api/handlers/pinpad.rs:28:1
   |
28 | / pub async fn attest_pinpad(
29 | |     State(state): State<Arc<AppState>>,
30 | |     Json(req): Json<AttestPinpadRequest>,
31 | | ) -> Result<impl IntoResponse, AppError> {
   | |________________________________________^
   |
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
   = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
   = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
  --> src/api/handlers/pinpad.rs:31:42
   |
31 |   ) -> Result<impl IntoResponse, AppError> {
   |  __________________________________________^
32 | |     // 调用设备服务的PINPad鉴证方法
33 | |     let response = state.device_service.attest_pinpad_device(req).await?;
...  |
36 | | }
   | |_^
help: use `()` annotations to avoid fallback changes
   |
33 |     let response: () = state.device_service.attest_pinpad_device(req).await?;
   |                 ++++

error[E0061]: this method takes 2 arguments but 1 argument was supplied
   --> src/api/handlers/pinpad.rs:46:49
    |
 46 |     let response = state.key_management_service.encrypt_pin(req).await?;
    |                                                 ^^^^^^^^^^^----- argument #2 of type `&str` is missing
    |
note: method defined here
   --> src/services/key_management.rs:245:18
    |
245 |     pub async fn encrypt_pin(
    |                  ^^^^^^^^^^^
...
248 |         operator: &str,
    |         --------------
help: provide the argument
    |
 46 |     let response = state.key_management_service.encrypt_pin(req, /* &str */).await?;
    |                                                                ++++++++++++

error[E0061]: this method takes 8 arguments but 6 arguments were supplied
   --> src/api/handlers/pinpad.rs:61:10
    |
 61 |           .list_logs(
    |  __________^^^^^^^^^-
 62 | |             query.device_id.as_deref(),
 63 | |             Some("PIN_ENCRYPTION"),
 64 | |             query.start_time.as_deref(),
 65 | |             query.end_time.as_deref(),
    | |             ------------------------- argument #4 of type `std::option::Option<OperationResult>` is missing
 66 | |             query.page.unwrap_or(1),
 67 | |             query.page_size.unwrap_or(20),
 68 | |         )
    | |_________- argument #7 of type `i64` is missing
    |
note: expected `Option<&str>`, found `i64`
   --> src/api/handlers/pinpad.rs:66:13
    |
 66 |             query.page.unwrap_or(1),
    |             ^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<&str>`
               found type `i64`
note: method defined here
   --> src/services/audit.rs:125:18
    |
125 |     pub async fn list_logs(
    |                  ^^^^^^^^^
...
130 |         result: Option<OperationResult>,
    |         -------------------------------
131 |         start_time: Option<&str>,
132 |         end_time: Option<&str>,
    |         ----------------------
133 |         limit: i64,
    |         ----------
help: provide the arguments
    |
 61 ~         .list_logs(
 62 +             query.device_id.as_deref(),
 63 +             Some("PIN_ENCRYPTION"),
 64 +             query.start_time.as_deref(),
 65 +             /* std::option::Option<OperationResult> */,
 66 +             query.end_time.as_deref(),
 67 +             /* std::option::Option<&str> */,
 68 +             /* i64 */,
 69 +             query.page_size.unwrap_or(20),
 70 +         )
    |

warning: unused variable: `state`
  --> src/api/handlers/pinpad.rs:78:11
   |
78 |     State(state): State<Arc<AppState>>,
   |           ^^^^^ help: if this is intentional, prefix it with an underscore: `_state`

error[E0599]: no variant or associated item named `PINPad` found for enum `DeviceMode` in the current scope
   --> src/api/handlers/pinpad.rs:124:81
    |
124 |         is_pinpad_mode: matches!(device.device_mode, crate::models::DeviceMode::PINPad),
    |                                                                                 ^^^^^^ variant or associated item not found in `DeviceMode`
    |
   ::: src/models/device.rs:59:1
    |
 59 | pub enum DeviceMode {
    | ------------------- variant or associated item `PINPad` not found for this enum
    |
help: there is a variant with a similar name
    |
124 -         is_pinpad_mode: matches!(device.device_mode, crate::models::DeviceMode::PINPad),
124 +         is_pinpad_mode: matches!(device.device_mode, crate::models::DeviceMode::PinPad),
    |

error[E0061]: this method takes 6 arguments but 8 arguments were supplied
   --> src/api/handlers/threat.rs:44:10
    |
 44 |         .list_threats(
    |          ^^^^^^^^^^^^
 45 |             query.device_id.as_deref(),
 46 |             query.threat_type,
    |             ----------------- expected `std::option::Option<ThreatStatus>`, found `std::option::Option<ThreatType>`
 47 |             query.severity,
 48 |             query.status,
    |             ------------ expected `std::option::Option<ThreatType>`, found `std::option::Option<ThreatStatus>`
 49 |             query.start_time.as_deref(),
    |             --------------------------- unexpected argument #5 of type `std::option::Option<&str>`
 50 |             query.end_time.as_deref(),
    |             ------------------------- unexpected argument #6 of type `std::option::Option<&str>`
    |
note: method defined here
   --> src/services/threat_detection.rs:130:18
    |
130 |     pub async fn list_threats(
    |                  ^^^^^^^^^^^^
help: did you mean
    |
 44 ~         .list_threats(
 45 +             query.device_id.as_deref(),
 46 +             query.status,
 47 +             query.severity,
 48 +             query.threat_type,
 49 +             query.page.unwrap_or(1),
 50 +             query.page_size.unwrap_or(20),
 51 +         )
    |

warning: this function depends on never type fallback being `()`
  --> src/api/handlers/threat.rs:37:1
   |
37 | / pub async fn list_threats(
38 | |     State(state): State<Arc<AppState>>,
39 | |     Query(query): Query<ListThreatsQuery>,
40 | | ) -> Result<impl IntoResponse, AppError> {
   | |________________________________________^
   |
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
   = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
   = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
  --> src/api/handlers/threat.rs:40:42
   |
40 |   ) -> Result<impl IntoResponse, AppError> {
   |  __________________________________________^
41 | |     // 调用服务层
42 | |     let response = state
43 | |         .threat_detection_service
...  |
56 | |     Ok((StatusCode::OK, Json(response)))
57 | | }
   | |_^
help: use `()` annotations to avoid fallback changes
   |
42 |     let response: () = state
   |                 ++++

error[E0061]: this method takes 6 arguments but 8 arguments were supplied
   --> src/api/handlers/threat.rs:71:10
    |
 71 |         .list_threats(None, None, None, None, None, None, 1, 1000)
    |          ^^^^^^^^^^^^                         ----  ---- unexpected argument #6 of type `std::option::Option<_>`
    |                                               |
    |                                               unexpected argument #5 of type `std::option::Option<_>`
    |
note: method defined here
   --> src/services/threat_detection.rs:130:18
    |
130 |     pub async fn list_threats(
    |                  ^^^^^^^^^^^^
help: remove the extra arguments
    |
 71 -         .list_threats(None, None, None, None, None, None, 1, 1000)
 71 +         .list_threats(None, None, None, None, 1, 1000)
    |

error[E0308]: mismatched types
   --> src/api/handlers/threat.rs:98:51
    |
 98 |         .resolve_threat(&threat_id, &operator_id, req.resolution_notes.as_deref())
    |          --------------                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `Option<String>`, found `Option<&str>`
    |          |
    |          arguments to this method are incorrect
    |
    = note: expected enum `std::option::Option<std::string::String>`
               found enum `std::option::Option<&str>`
note: method defined here
   --> src/services/threat_detection.rs:160:18
    |
160 |     pub async fn resolve_threat(
    |                  ^^^^^^^^^^^^^^
...
164 |         resolution_notes: Option<String>,
    |         --------------------------------
help: try removing the method call
    |
 98 -         .resolve_threat(&threat_id, &operator_id, req.resolution_notes.as_deref())
 98 +         .resolve_threat(&threat_id, &operator_id, req.resolution_notes)
    |

error[E0061]: this method takes 6 arguments but 8 arguments were supplied
   --> src/api/handlers/threat.rs:141:10
    |
141 |         .list_threats(
    |          ^^^^^^^^^^^^
142 |             Some(&device_id),
143 |             query.threat_type,
    |             ----------------- expected `std::option::Option<ThreatStatus>`, found `std::option::Option<ThreatType>`
144 |             query.severity,
145 |             query.status,
    |             ------------ expected `std::option::Option<ThreatType>`, found `std::option::Option<ThreatStatus>`
146 |             query.start_time.as_deref(),
    |             --------------------------- unexpected argument #5 of type `std::option::Option<&str>`
147 |             query.end_time.as_deref(),
    |             ------------------------- unexpected argument #6 of type `std::option::Option<&str>`
    |
note: method defined here
   --> src/services/threat_detection.rs:130:18
    |
130 |     pub async fn list_threats(
    |                  ^^^^^^^^^^^^
help: did you mean
    |
141 ~         .list_threats(
142 +             Some(&device_id),
143 +             query.status,
144 +             query.severity,
145 +             query.threat_type,
146 +             query.page.unwrap_or(1),
147 +             query.page_size.unwrap_or(20),
148 +         )
    |

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/threat.rs:133:1
    |
133 | / pub async fn get_device_threat_history(
134 | |     State(state): State<Arc<AppState>>,
135 | |     Path(device_id): Path<String>,
136 | |     Query(query): Query<ListThreatsQuery>,
137 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/threat.rs:137:42
    |
137 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
138 | |     // 调用服务层，只获取特定设备的威胁
139 | |     let response = state
140 | |         .threat_detection_service
...   |
153 | |     Ok((StatusCode::OK, Json(response)))
154 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
139 |     let response: () = state
    |                 ++++

error[E0061]: this method takes 2 arguments but 1 argument was supplied
  --> src/api/handlers/transaction.rs:38:46
   |
38 |     let response = state.transaction_service.attest_transaction(req).await?;
   |                                              ^^^^^^^^^^^^^^^^^^----- argument #2 of type `&str` is missing
   |
note: method defined here
  --> src/services/transaction.rs:46:18
   |
46 |     pub async fn attest_transaction(
   |                  ^^^^^^^^^^^^^^^^^^
...
49 |         operator: &str,
   |         --------------
help: provide the argument
   |
38 |     let response = state.transaction_service.attest_transaction(req, /* &str */).await?;
   |                                                                    ++++++++++++

error[E0061]: this method takes 2 arguments but 1 argument was supplied
   --> src/api/handlers/transaction.rs:51:46
    |
 51 |     let response = state.transaction_service.process_transaction(req).await?;
    |                                              ^^^^^^^^^^^^^^^^^^^----- argument #2 of type `&str` is missing
    |
note: method defined here
   --> src/services/transaction.rs:111:18
    |
111 |     pub async fn process_transaction(
    |                  ^^^^^^^^^^^^^^^^^^^
...
114 |         operator: &str,
    |         --------------
help: provide the argument
    |
 51 |     let response = state.transaction_service.process_transaction(req, /* &str */).await?;
    |                                                                     ++++++++++++

error[E0061]: this method takes 5 arguments but 6 arguments were supplied
   --> src/api/handlers/transaction.rs:66:10
    |
 66 |         .list_transactions(
    |          ^^^^^^^^^^^^^^^^^
...
 70 |             query.end_time.as_deref(),
    |             ------------------------- unexpected argument #4 of type `std::option::Option<&str>`
    |
note: expected `Option<TransactionType>`, found `Option<&str>`
   --> src/api/handlers/transaction.rs:69:13
    |
 69 |             query.start_time.as_deref(),
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<TransactionType>`
               found enum `std::option::Option<&str>`
note: method defined here
   --> src/services/transaction.rs:278:18
    |
278 |     pub async fn list_transactions(
    |                  ^^^^^^^^^^^^^^^^^
...
282 |         transaction_type: Option<TransactionType>,
    |         -----------------------------------------
help: remove the extra argument
    |
 69 -             query.start_time.as_deref(),
 69 +             /* std::option::Option<TransactionType> */,
    |

error[E0061]: this method takes 5 arguments but 6 arguments were supplied
   --> src/api/handlers/transaction.rs:106:10
    |
106 |         .list_transactions(
    |          ^^^^^^^^^^^^^^^^^
...
110 |             query.end_time.as_deref(),
    |             ------------------------- unexpected argument #4 of type `std::option::Option<&str>`
    |
note: expected `Option<TransactionType>`, found `Option<&str>`
   --> src/api/handlers/transaction.rs:109:13
    |
109 |             query.start_time.as_deref(),
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    = note: expected enum `std::option::Option<TransactionType>`
               found enum `std::option::Option<&str>`
note: method defined here
   --> src/services/transaction.rs:278:18
    |
278 |     pub async fn list_transactions(
    |                  ^^^^^^^^^^^^^^^^^
...
282 |         transaction_type: Option<TransactionType>,
    |         -----------------------------------------
help: remove the extra argument
    |
109 -             query.start_time.as_deref(),
109 +             /* std::option::Option<TransactionType> */,
    |

warning: unused variable: `state`
   --> src/api/handlers/transaction.rs:123:11
    |
123 |     State(state): State<Arc<AppState>>,
    |           ^^^^^ help: if this is intentional, prefix it with an underscore: `_state`

warning: this function depends on never type fallback being `()`
  --> src/api/handlers/version.rs:40:1
   |
40 | / pub async fn create_version(
41 | |     State(state): State<Arc<AppState>>,
42 | |     request: axum::extract::Request,
43 | |     Json(req): Json<CreateVersionRequest>,
44 | | ) -> Result<impl IntoResponse, AppError> {
   | |________________________________________^
   |
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
   = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
   = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
  --> src/api/handlers/version.rs:44:42
   |
44 |   ) -> Result<impl IntoResponse, AppError> {
   |  __________________________________________^
45 | |     // 提取操作员ID
46 | |     let operator_id = extract_user_id(&request)?;
...  |
51 | |     Ok((StatusCode::CREATED, Json(response)))
52 | | }
   | |_^
help: use `()` annotations to avoid fallback changes
   |
49 |     let response: () = state.version_service.create_version(req, &operator_id).await?;
   |                 ++++

error[E0599]: no method named `get_compatibility_matrix` found for struct `Arc<VersionService>` in the current scope
   --> src/api/handlers/version.rs:128:40
    |
128 |     let matrix = state.version_service.get_compatibility_matrix().await?;
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^ method not found in `Arc<VersionService>`

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/version.rs:124:1
    |
124 | / pub async fn get_compatibility_matrix(
125 | |     State(state): State<Arc<AppState>>,
126 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/version.rs:126:42
    |
126 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
127 | |     // 调用服务层
128 | |     let matrix = state.version_service.get_compatibility_matrix().await?;
...   |
131 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
128 |     let matrix: () = state.version_service.get_compatibility_matrix().await?;
    |               ++++

error[E0599]: no method named `create_push_task` found for struct `Arc<VersionService>` in the current scope
   --> src/api/handlers/version.rs:147:10
    |
145 |       let response = state
    |  ____________________-
146 | |         .version_service
147 | |         .create_push_task(req, &operator_id)
    | |         -^^^^^^^^^^^^^^^^ method not found in `Arc<VersionService>`
    | |_________|
    |

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/version.rs:136:1
    |
136 | / pub async fn create_push_task(
137 | |     State(state): State<Arc<AppState>>,
138 | |     request: axum::extract::Request,
139 | |     Json(req): Json<CreatePushTaskRequest>,
140 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/version.rs:140:42
    |
140 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
141 | |     // 提取操作员ID
142 | |     let operator_id = extract_user_id(&request)?;
...   |
150 | |     Ok((StatusCode::CREATED, Json(response)))
151 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
145 |     let response: () = state
    |                 ++++

error[E0599]: no method named `list_push_tasks` found for struct `Arc<VersionService>` in the current scope
   --> src/api/handlers/version.rs:163:10
    |
161 |       let response = state
    |  ____________________-
162 | |         .version_service
163 | |         .list_push_tasks(
    | |         -^^^^^^^^^^^^^^^ method not found in `Arc<VersionService>`
    | |_________|
    |

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/version.rs:156:1
    |
156 | / pub async fn list_push_tasks(
157 | |     State(state): State<Arc<AppState>>,
158 | |     Query(query): Query<ListPushTasksQuery>,
159 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/version.rs:159:42
    |
159 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
160 | |     // 调用服务层
161 | |     let response = state
162 | |         .version_service
...   |
171 | |     Ok((StatusCode::OK, Json(response)))
172 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
161 |     let response: () = state
    |                 ++++

error[E0599]: no method named `get_push_task` found for struct `Arc<VersionService>` in the current scope
   --> src/api/handlers/version.rs:182:42
    |
182 |     let response = state.version_service.get_push_task(&task_id).await?;
    |                                          ^^^^^^^^^^^^^ method not found in `Arc<VersionService>`

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/version.rs:177:1
    |
177 | / pub async fn get_push_task(
178 | |     State(state): State<Arc<AppState>>,
179 | |     Path(task_id): Path<String>,
180 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/version.rs:180:42
    |
180 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
181 | |     // 调用服务层
182 | |     let response = state.version_service.get_push_task(&task_id).await?;
...   |
185 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
182 |     let response: () = state.version_service.get_push_task(&task_id).await?;
    |                 ++++

error[E0061]: this method takes 2 arguments but 1 argument was supplied
   --> src/api/handlers/version.rs:197:10
    |
197 |         .get_available_version(&device_id)
    |          ^^^^^^^^^^^^^^^^^^^^^------------ argument #2 of type `&str` is missing
    |
note: method defined here
   --> src/services/version.rs:138:18
    |
138 |     pub async fn get_available_version(
    |                  ^^^^^^^^^^^^^^^^^^^^^
...
141 |         current_version: &str,
    |         ---------------------
help: provide the argument
    |
197 |         .get_available_version(&device_id, /* &str */)
    |                                          ++++++++++++

error[E0061]: this method takes 1 argument but 0 arguments were supplied
   --> src/api/handlers/version.rs:210:42
    |
210 |     let response = state.version_service.get_outdated_devices().await?;
    |                                          ^^^^^^^^^^^^^^^^^^^^-- argument #1 of type `&str` is missing
    |
note: method defined here
   --> src/services/version.rs:294:18
    |
294 |     pub async fn get_outdated_devices(&self, latest_version: &str) -> Result<Vec<String>, AppError> {
    |                  ^^^^^^^^^^^^^^^^^^^^        --------------------
help: provide the argument
    |
210 |     let response = state.version_service.get_outdated_devices(/* &str */).await?;
    |                                                               ++++++++++

error[E0599]: no method named `get_update_dashboard` found for struct `Arc<VersionService>` in the current scope
   --> src/api/handlers/version.rs:222:42
    |
222 |     let response = state.version_service.get_update_dashboard().await?;
    |                                          ^^^^^^^^^^^^^^^^^^^^ method not found in `Arc<VersionService>`

warning: this function depends on never type fallback being `()`
   --> src/api/handlers/version.rs:218:1
    |
218 | / pub async fn get_update_dashboard(
219 | |     State(state): State<Arc<AppState>>,
220 | | ) -> Result<impl IntoResponse, AppError> {
    | |________________________________________^
    |
    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in Rust 2024 and in a future release in all editions!
    = note: for more information, see <https://doc.rust-lang.org/edition-guide/rust-2024/never-type-fallback.html>
    = help: specify the types explicitly
note: in edition 2024, the requirement `!: Serialize` will fail
   --> src/api/handlers/version.rs:220:42
    |
220 |   ) -> Result<impl IntoResponse, AppError> {
    |  __________________________________________^
221 | |     // 调用服务层
222 | |     let response = state.version_service.get_update_dashboard().await?;
...   |
225 | | }
    | |_^
help: use `()` annotations to avoid fallback changes
    |
222 |     let response: () = state.version_service.get_update_dashboard().await?;
    |                 ++++

error[E0599]: no method named `split` found for struct `WebSocket` in the current scope
    --> src/api/websocket/connection.rs:60:45
     |
  60 |     let (mut sender, mut receiver) = socket.split();
     |                                             ^^^^^ method not found in `WebSocket`
     |
    ::: /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/futures-util-0.3.31/src/stream/stream/mod.rs:1582:8
     |
1582 |     fn split<Item>(self) -> (SplitSink<Self, Item>, SplitStream<Self>)
     |        ----- the method is available for `WebSocket` here
     |
     = help: items from traits can only be used if the trait is in scope
help: trait `StreamExt` which provides `split` is implemented but not in scope; perhaps you want to import it
     |
   1 + use futures_util::stream::stream::StreamExt;
     |

error[E0308]: mismatched types
  --> src/api/mod.rs:64:35
   |
64 |         let redis_client = if let Some(ref redis_config) = config.redis {
   |                                   ^^^^^^^^^^^^^^^^^^^^^^   ------------ this expression has type `config::RedisConfig`
   |                                   |
   |                                   expected `RedisConfig`, found `Option<_>`
   |
   = note: expected struct `config::RedisConfig`
                found enum `std::option::Option<_>`

error[E0308]: mismatched types
  --> src/api/mod.rs:71:33
   |
71 |         let hsm_client = if let Some(ref hsm_config) = config.hsm {
   |                                 ^^^^^^^^^^^^^^^^^^^^   ---------- this expression has type `config::HsmConfig`
   |                                 |
   |                                 expected `HsmConfig`, found `Option<_>`
   |
   = note: expected struct `config::HsmConfig`
                found enum `std::option::Option<_>`

error[E0061]: this function takes 1 argument but 2 arguments were supplied
  --> src/api/mod.rs:72:18
   |
72 |             Some(HsmClient::new(
   |                  ^^^^^^^^^^^^^^
73 |                 hsm_config.url.clone(),
74 |                 hsm_config.api_key.clone(),
   |                 -------------------------- unexpected argument #2
   |
note: associated function defined here
  --> src/infrastructure/hsm_client.rs:60:12
   |
60 |     pub fn new(config: HsmConfig) -> Result<Self, AppError> {
   |            ^^^
help: remove the extra argument
   |
73 -                 hsm_config.url.clone(),
74 -                 hsm_config.api_key.clone(),
73 +                 hsm_config.url.clone(),
   |

error[E0609]: no field `security` on type `config::Config`
  --> src/api/mod.rs:87:20
   |
87 |             config.security.bdk.clone().into_bytes(),
   |                    ^^^^^^^^ unknown field
   |
   = note: available fields are: `server`, `database`, `redis`, `jwt`, `hsm` ... and 2 others

error[E0599]: the method `clone` exists for enum `std::option::Option<Result<HsmClient, AppError>>`, but its trait bounds were not satisfied
   --> src/api/mod.rs:103:24
    |
103 |             hsm_client.clone(),
    |                        ^^^^^ method cannot be called on `std::option::Option<Result<HsmClient, AppError>>` due to unsatisfied trait bounds
    |
    = note: the following trait bounds were not satisfied:
            `Result<HsmClient, AppError>: Clone`
            which is required by `std::option::Option<Result<HsmClient, AppError>>: Clone`

error[E0599]: the method `clone` exists for enum `std::option::Option<Result<HsmClient, AppError>>`, but its trait bounds were not satisfied
   --> src/api/mod.rs:110:24
    |
110 |             hsm_client.clone(),
    |                        ^^^^^ method cannot be called on `std::option::Option<Result<HsmClient, AppError>>` due to unsatisfied trait bounds
    |
    = note: the following trait bounds were not satisfied:
            `Result<HsmClient, AppError>: Clone`
            which is required by `std::option::Option<Result<HsmClient, AppError>>: Clone`

error[E0599]: the method `clone` exists for enum `std::option::Option<Result<HsmClient, AppError>>`, but its trait bounds were not satisfied
   --> src/api/mod.rs:118:24
    |
118 |             hsm_client.clone(),
    |                        ^^^^^ method cannot be called on `std::option::Option<Result<HsmClient, AppError>>` due to unsatisfied trait bounds
    |
    = note: the following trait bounds were not satisfied:
            `Result<HsmClient, AppError>: Clone`
            which is required by `std::option::Option<Result<HsmClient, AppError>>: Clone`

error[E0308]: mismatched types
   --> src/api/mod.rs:153:13
    |
153 |             hsm_client,
    |             ^^^^^^^^^^ expected `Option<HsmClient>`, found `Option<Result<HsmClient, AppError>>`
    |
    = note: expected enum `std::option::Option<HsmClient>`
               found enum `std::option::Option<Result<HsmClient, AppError>>`

error[E0061]: this method takes 6 arguments but 8 arguments were supplied
   --> src/services/audit.rs:140:14
    |
140 |             .list(
    |              ^^^^
...
145 |                 start_time,
    |                 ---------- unexpected argument #5 of type `std::option::Option<&str>`
146 |                 end_time,
    |                 -------- unexpected argument #6 of type `std::option::Option<&str>`
    |
note: method defined here
   --> src/repositories/audit_log.rs:44:18
    |
 44 |     pub async fn list(
    |                  ^^^^
help: remove the extra arguments
    |
144 -                 result,
145 -                 start_time,
144 +                 result,
    |

error[E0061]: this method takes 4 arguments but 6 arguments were supplied
   --> src/services/audit.rs:154:14
    |
154 |             .count(operation_type, operator, device_id, result, start_time, end_time)
    |              ^^^^^                                              ----------  -------- unexpected argument #6 of type `std::option::Option<&str>`
    |                                                                 |
    |                                                                 unexpected argument #5 of type `std::option::Option<&str>`
    |
note: method defined here
   --> src/repositories/audit_log.rs:90:18
    |
 90 |     pub async fn count(
    |                  ^^^^^
help: remove the extra arguments
    |
154 -             .count(operation_type, operator, device_id, result, start_time, end_time)
154 +             .count(operation_type, operator, device_id, result)
    |

error[E0599]: no function or associated item named `new` found for struct `Device` in the current scope
  --> src/services/device.rs:58:34
   |
58 |         let mut device = Device::new(
   |                                  ^^^ function or associated item not found in `Device`
   |
  ::: src/models/device.rs:8:1
   |
 8 | pub struct Device {
   | ----------------- function or associated item `new` not found for this struct
   |
   = help: items from traits can only be used if the trait is implemented and in scope
   = note: the following traits define an item `new`, perhaps you need to implement one of them:
           candidate #1: `Atomic`
           candidate #2: `BoundKey`
           candidate #3: `UniformSampler`
           candidate #4: `ahash::HashMapExt`
           candidate #5: `ahash::HashSetExt`
           candidate #6: `crypto_common::KeyInit`
           candidate #7: `crypto_common::KeyIvInit`
           candidate #8: `digest::VariableOutput`
           candidate #9: `digest::core_api::VariableOutputCore`
           candidate #10: `digest::digest::Digest`
           candidate #11: `digest::mac::Mac`
           candidate #12: `futures_intrusive::buffer::ring_buffer::RingBuf`
           candidate #13: `nonzero_ext::NonZero`
           candidate #14: `parking_lot_core::thread_parker::ThreadParkerT`
           candidate #15: `protobuf::message::Message`
           candidate #16: `typenum::marker_traits::Bit`

error[E0658]: use of unstable library feature `str_as_str`
   --> src/services/device.rs:115:60
    |
115 |         if device.status != DeviceStatus::Pending.as_str().as_str() {
    |                                                            ^^^^^^
    |
    = note: see issue #130366 <https://github.com/rust-lang/rust/issues/130366> for more information

error[E0658]: use of unstable library feature `str_as_str`
   --> src/services/device.rs:160:60
    |
160 |         if device.status != DeviceStatus::Pending.as_str().as_str() {
    |                                                            ^^^^^^
    |
    = note: see issue #130366 <https://github.com/rust-lang/rust/issues/130366> for more information

error[E0658]: use of unstable library feature `str_as_str`
   --> src/services/device.rs:289:62
    |
289 |         if device.status != DeviceStatus::Suspended.as_str().as_str() {
    |                                                              ^^^^^^
    |
    = note: see issue #130366 <https://github.com/rust-lang/rust/issues/130366> for more information

error[E0308]: mismatched types
   --> src/services/device.rs:333:37
    |
333 |         if !matches!(device.status, DeviceStatus::Active | DeviceStatus::Suspended) {
    |                      -------------  ^^^^^^^^^^^^^^^^^^^^ expected `String`, found `DeviceStatus`
    |                      |
    |                      this expression has type `std::string::String`
    |
   ::: src/models/device.rs:94:5
    |
 94 |     Active,
    |     ------ unit variant defined here

error[E0308]: mismatched types
   --> src/services/device.rs:333:60
    |
333 |         if !matches!(device.status, DeviceStatus::Active | DeviceStatus::Suspended) {
    |                      -------------                         ^^^^^^^^^^^^^^^^^^^^^^^ expected `String`, found `DeviceStatus`
    |                      |
    |                      this expression has type `std::string::String`
    |
   ::: src/models/device.rs:95:5
    |
 95 |     Suspended,
    |     --------- unit variant defined here

error[E0308]: mismatched types
   --> src/services/health_check.rs:107:33
    |
107 |             recommended_action: health_check.recommended_action,
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `String`, found `RecommendedAction`
    |
help: try using a conversion method
    |
107 |             recommended_action: health_check.recommended_action.to_string(),
    |                                                                ++++++++++++

error[E0308]: mismatched types
   --> src/services/health_check.rs:108:31
    |
108 |             threats_detected: threats.len() as i32,
    |                               ^^^^^^^^^^^^^^^^^^^^ expected `Vec<String>`, found `i32`
    |
    = note: expected struct `Vec<std::string::String>`
                 found type `i32`

error[E0560]: struct `dto::response::HealthCheckResponse` has no field named `message`
   --> src/services/health_check.rs:109:13
    |
109 |             message: "Health check completed successfully".to_string(),
    |             ^^^^^^^ `dto::response::HealthCheckResponse` does not have this field
    |
    = note: available fields are: `checked_at`

error[E0308]: arguments to this function are incorrect
   --> src/services/health_check.rs:138:9
    |
138 |         crypto::verify_signature(&device.public_key, &data, signature)?;
    |         ^^^^^^^^^^^^^^^^^^^^^^^^                     -----  --------- expected `&[u8]`, found `&str`
    |                                                      |
    |                                                      expected `&[u8]`, found `&String`
    |
    = note: expected reference `&[u8]`
               found reference `&std::string::String`
    = note: expected reference `&[u8]`
               found reference `&str`
note: function defined here
   --> src/security/crypto.rs:52:8
    |
 52 | pub fn verify_signature(
    |        ^^^^^^^^^^^^^^^^
 53 |     public_key_der: &[u8],
 54 |     message: &[u8],
    |     --------------
 55 |     signature: &[u8],
    |     ----------------

error[E0308]: mismatched types
   --> src/services/health_check.rs:352:37
    |
352 |                 recommended_action: check.recommended_action,
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^ expected `String`, found `RecommendedAction`
    |
help: try using a conversion method
    |
352 |                 recommended_action: check.recommended_action.to_string(),
    |                                                             ++++++++++++

error[E0308]: mismatched types
   --> src/services/health_check.rs:353:35
    |
353 |                 threats_detected: 0, // 需要单独查询
    |                                   ^ expected `Vec<String>`, found integer
    |
    = note: expected struct `Vec<std::string::String>`
                 found type `{integer}`

error[E0560]: struct `dto::response::HealthCheckResponse` has no field named `message`
   --> src/services/health_check.rs:354:17
    |
354 |                 message: "Health check record".to_string(),
    |                 ^^^^^^^ `dto::response::HealthCheckResponse` does not have this field
    |
    = note: available fields are: `checked_at`

error[E0308]: mismatched types
   --> src/services/health_check.rs:382:27
    |
382 |             latest_score: latest_check.as_ref().map(|c| c.security_score),
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `i32`, found `Option<i32>`
    |
    = note: expected type `i32`
               found enum `std::option::Option<i32>`
help: consider using `Option::expect` to unwrap the `std::option::Option<i32>` value, panicking if the value is an `Option::None`
    |
382 |             latest_score: latest_check.as_ref().map(|c| c.security_score).expect("REASON"),
    |                                                                          +++++++++++++++++

error[E0560]: struct `dto::response::HealthOverviewResponse` has no field named `recommended_action`
   --> src/services/health_check.rs:383:13
    |
383 |             recommended_action: latest_check.as_ref().map(|c| c.recommended_action),
    |             ^^^^^^^^^^^^^^^^^^ `dto::response::HealthOverviewResponse` does not have this field
    |
    = note: available fields are: `average_score`

error[E0560]: struct `dto::response::HealthOverviewResponse` has no field named `active_threats`
   --> src/services/health_check.rs:384:13
    |
384 |             active_threats: active_threats.len() as i32,
    |             ^^^^^^^^^^^^^^ `dto::response::HealthOverviewResponse` does not have this field
    |
    = note: available fields are: `average_score`

error[E0282]: type annotations needed
  --> src/services/key_management.rs:69:38
   |
69 |         let ksn = device.current_ksn.as_ref().ok_or_else(|| {
   |                                      ^^^^^^   ---------- type must be known at this point
   |
help: try using a fully qualified path to specify the expected types
   |
69 -         let ksn = device.current_ksn.as_ref().ok_or_else(|| {
69 +         let ksn = <std::string::String as AsRef<T>>::as_ref(&device.current_ksn).ok_or_else(|| {
   |

error[E0308]: mismatched types
  --> src/services/key_management.rs:83:62
   |
83 |         let encrypted_ipek = crypto::encrypt_with_public_key(&device.public_key, &ipek)?;
   |                              ------------------------------- ^^^^^^^^^^^^^^^^^^ expected `&str`, found `&Vec<u8>`
   |                              |
   |                              arguments to this function are incorrect
   |
   = note: expected reference `&str`
              found reference `&Vec<u8>`
note: function defined here
  --> src/security/crypto.rs:35:8
   |
35 | pub fn encrypt_with_public_key(_public_key_pem: &str, data: &[u8]) -> Result<Vec<u8>, AppError> {
   |        ^^^^^^^^^^^^^^^^^^^^^^^ ---------------------

error[E0061]: this method takes 3 arguments but 6 arguments were supplied
   --> src/services/key_management.rs:89:14
    |
 89 |             .update_key_info(
    |              ^^^^^^^^^^^^^^^
...
 93 |                 None,
    |                 ---- unexpected argument #4 of type `std::option::Option<_>`
 94 |                 Some(0),
    |                 ------- unexpected argument #5 of type `std::option::Option<{integer}>`
 95 |                 Some(1000), // 默认最大使用次数
    |                 ---------- unexpected argument #6 of type `std::option::Option<{integer}>`
    |
note: method defined here
   --> src/repositories/device.rs:234:18
    |
234 |     pub async fn update_key_info(
    |                  ^^^^^^^^^^^^^^^
help: remove the extra arguments
    |
 92 -                 Some(&now),
 93 -                 None,
 92 +                 Some(&now), // 默认最大使用次数
    |

error[E0282]: type annotations needed
   --> src/services/key_management.rs:151:46
    |
151 |         let current_ksn = device.current_ksn.as_ref().ok_or_else(|| {
    |                                              ^^^^^^   ---------- type must be known at this point
    |
help: try using a fully qualified path to specify the expected types
    |
151 -         let current_ksn = device.current_ksn.as_ref().ok_or_else(|| {
151 +         let current_ksn = <std::string::String as AsRef<T>>::as_ref(&device.current_ksn).ok_or_else(|| {
    |

error[E0308]: mismatched types
   --> src/services/key_management.rs:166:62
    |
166 |         let encrypted_ipek = crypto::encrypt_with_public_key(&device.public_key, &new_ipek)?;
    |                              ------------------------------- ^^^^^^^^^^^^^^^^^^ expected `&str`, found `&Vec<u8>`
    |                              |
    |                              arguments to this function are incorrect
    |
    = note: expected reference `&str`
               found reference `&Vec<u8>`
note: function defined here
   --> src/security/crypto.rs:35:8
    |
 35 | pub fn encrypt_with_public_key(_public_key_pem: &str, data: &[u8]) -> Result<Vec<u8>, AppError> {
    |        ^^^^^^^^^^^^^^^^^^^^^^^ ---------------------

error[E0061]: this method takes 3 arguments but 6 arguments were supplied
   --> src/services/key_management.rs:172:14
    |
172 |             .update_key_info(
    |              ^^^^^^^^^^^^^^^
...
176 |                 Some(&now),
    |                 ---------- unexpected argument #4 of type `std::option::Option<&std::string::String>`
177 |                 Some(0), // 重置使用次数
    |                 ------- unexpected argument #5 of type `std::option::Option<{integer}>`
178 |                 device.key_total_count,
    |                 ---------------------- unexpected argument #6 of type `i32`
    |
note: method defined here
   --> src/repositories/device.rs:234:18
    |
234 |     pub async fn update_key_info(
    |                  ^^^^^^^^^^^^^^^
help: remove the extra arguments
    |
175 -                 None,
176 -                 Some(&now),
175 +                 None,
    |

error[E0599]: no method named `ok_or_else` found for struct `std::string::String` in the current scope
   --> src/services/key_management.rs:223:38
    |
223 |         let ksn = device.current_ksn.ok_or_else(|| {
    |                   -------------------^^^^^^^^^^ method not found in `std::string::String`

error[E0599]: no method named `unwrap_or` found for type `i32` in the current scope
   --> src/services/key_management.rs:227:54
    |
227 |         let usage_count = device.key_remaining_count.unwrap_or(0);
    |                                                      ^^^^^^^^^ method not found in `i32`

error[E0599]: no method named `unwrap_or` found for type `i32` in the current scope
   --> src/services/key_management.rs:228:48
    |
228 |         let max_usage = device.key_total_count.unwrap_or(1000);
    |                                                ^^^^^^^^^ method not found in `i32`

error[E0308]: mismatched types
   --> src/services/key_management.rs:240:25
    |
240 |             updated_at: device.updated_at,
    |                         ^^^^^^^^^^^^^^^^^ expected `Option<String>`, found `String`
    |
    = note: expected enum `std::option::Option<std::string::String>`
             found struct `std::string::String`
help: try wrapping the expression in `Some`
    |
240 |             updated_at: Some(device.updated_at),
    |                         +++++                 +

error[E0282]: type annotations needed
   --> src/services/key_management.rs:274:38
    |
274 |         let ksn = device.current_ksn.as_ref().ok_or_else(|| {
    |                                      ^^^^^^   ---------- type must be known at this point
    |
help: try using a fully qualified path to specify the expected types
    |
274 -         let ksn = device.current_ksn.as_ref().ok_or_else(|| {
274 +         let ksn = <std::string::String as AsRef<T>>::as_ref(&device.current_ksn).ok_or_else(|| {
    |

error[E0308]: mismatched types
   --> src/services/key_management.rs:340:20
    |
340 |             if let Some(usage_count) = device.key_remaining_count {
    |                    ^^^^^^^^^^^^^^^^^   -------------------------- this expression has type `i32`
    |                    |
    |                    expected `i32`, found `Option<_>`
    |
    = note: expected type `i32`
               found enum `std::option::Option<_>`

error[E0308]: mismatched types
   --> src/services/key_management.rs:341:24
    |
341 |                 if let Some(max_usage) = device.key_total_count {
    |                        ^^^^^^^^^^^^^^^   ---------------------- this expression has type `i32`
    |                        |
    |                        expected `i32`, found `Option<_>`
    |
    = note: expected type `i32`
               found enum `std::option::Option<_>`

error[E0282]: type annotations needed
   --> src/services/transaction.rs:135:45
    |
135 |         let device_ksn = device.current_ksn.as_ref().ok_or_else(|| {
    |                                             ^^^^^^   ---------- type must be known at this point
    |
help: try using a fully qualified path to specify the expected types
    |
135 -         let device_ksn = device.current_ksn.as_ref().ok_or_else(|| {
135 +         let device_ksn = <std::string::String as AsRef<T>>::as_ref(&device.current_ksn).ok_or_else(|| {
    |

error[E0382]: use of moved value: `status`
   --> src/services/transaction.rs:295:31
    |
281 |         status: Option<TransactionStatus>,
    |         ------ move occurs because `status` has type `std::option::Option<TransactionStatus>`, which does not implement the `Copy` trait
...
290 |             .list(device_id, status, transaction_type, limit, offset)
    |                              ------ value moved here
...
295 |             .count(device_id, status, transaction_type)
    |                               ^^^^^^ value used here after move
    |
note: consider changing this parameter type in method `list` to borrow instead if owning the value isn't necessary
   --> src/repositories/transaction.rs:80:17
    |
 77 |     pub async fn list(
    |                  ---- in this method
...
 80 |         status: Option<TransactionStatus>,
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^ this parameter takes ownership of the value
help: consider cloning the value if the performance cost is acceptable
    |
290 |             .list(device_id, status.clone(), transaction_type, limit, offset)
    |                                    ++++++++

error[E0382]: use of moved value: `transaction_type`
   --> src/services/transaction.rs:295:39
    |
282 |         transaction_type: Option<TransactionType>,
    |         ---------------- move occurs because `transaction_type` has type `std::option::Option<TransactionType>`, which does not implement the `Copy` trait
...
290 |             .list(device_id, status, transaction_type, limit, offset)
    |                                      ---------------- value moved here
...
295 |             .count(device_id, status, transaction_type)
    |                                       ^^^^^^^^^^^^^^^^ value used here after move
    |
note: consider changing this parameter type in method `list` to borrow instead if owning the value isn't necessary
   --> src/repositories/transaction.rs:81:27
    |
 77 |     pub async fn list(
    |                  ---- in this method
...
 81 |         transaction_type: Option<TransactionType>,
    |                           ^^^^^^^^^^^^^^^^^^^^^^^ this parameter takes ownership of the value
help: consider cloning the value if the performance cost is acceptable
    |
290 |             .list(device_id, status, transaction_type.clone(), limit, offset)
    |                                                      ++++++++

error[E0599]: no method named `unwrap_or_default` found for struct `std::string::String` in the current scope
  --> src/services/version.rs:61:35
   |
61 |             request.release_notes.unwrap_or_default(),
   |                                   ^^^^^^^^^^^^^^^^^ method not found in `std::string::String`

warning: unused variable: `update_type`
   --> src/services/version.rs:113:9
    |
113 |         update_type: Option<UpdateType>,
    |         ^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_update_type`

error[E0382]: use of moved value: `status`
   --> src/services/version.rs:124:45
    |
112 |         status: Option<VersionStatus>,
    |         ------ move occurs because `status` has type `std::option::Option<VersionStatus>`, which does not implement the `Copy` trait
...
121 |             .list(status, limit, offset)
    |                   ------ value moved here
...
124 |         let total = self.version_repo.count(status).await?;
    |                                             ^^^^^^ value used here after move
    |
note: consider changing this parameter type in method `list` to borrow instead if owning the value isn't necessary
   --> src/repositories/version.rs:97:17
    |
 95 |     pub async fn list(
    |                  ---- in this method
 96 |         &self,
 97 |         status: Option<VersionStatus>,
    |                 ^^^^^^^^^^^^^^^^^^^^^ this parameter takes ownership of the value
help: consider cloning the value if the performance cost is acceptable
    |
121 |             .list(status.clone(), limit, offset)
    |                         ++++++++

error[E0061]: this method takes 1 argument but 4 arguments were supplied
   --> src/services/version.rs:236:14
    |
236 |             .update(
    |              ^^^^^^
237 |                 version_id,
    |                 ---------- expected `&SdkVersion`, found `&str`
238 |                 request.status,
    |                 -------------- unexpected argument #2
239 |                 request.release_notes,
    |                 --------------------- unexpected argument #3
240 |                 request.download_url,
    |                 -------------------- unexpected argument #4
    |
    = note: expected reference `&SdkVersion`
               found reference `&str`
note: method defined here
   --> src/repositories/version.rs:142:18
    |
142 |     pub async fn update(&self, version: &SdkVersion) -> Result<(), AppError> {
    |                  ^^^^^^        --------------------
help: remove the extra arguments
    |
237 -                 version_id,
237 +                 /* &SdkVersion */,
    |

error[E0061]: this method takes 1 argument but 2 arguments were supplied
   --> src/services/version.rs:276:39
    |
276 |         let total = self.version_repo.count(None, None).await?;
    |                                       ^^^^^       ---- unexpected argument #2 of type `std::option::Option<_>`
    |
note: method defined here
   --> src/repositories/version.rs:127:18
    |
127 |     pub async fn count(&self, status: Option<VersionStatus>) -> Result<i64, AppError> {
    |                  ^^^^^
help: remove the extra argument
    |
276 -         let total = self.version_repo.count(None, None).await?;
276 +         let total = self.version_repo.count(None).await?;
    |

error[E0599]: no variant or associated item named `Available` found for enum `VersionStatus` in the current scope
   --> src/services/version.rs:279:40
    |
279 |             .count(Some(VersionStatus::Available), None)
    |                                        ^^^^^^^^^ variant or associated item not found in `VersionStatus`
    |
   ::: src/models/version.rs:19:1
    |
 19 | pub enum VersionStatus {
    | ---------------------- variant or associated item `Available` not found for this enum

error[E0061]: this method takes 1 argument but 2 arguments were supplied
   --> src/services/version.rs:279:14
    |
279 |             .count(Some(VersionStatus::Available), None)
    |              ^^^^^                                 ---- unexpected argument #2 of type `std::option::Option<_>`
    |
note: method defined here
   --> src/repositories/version.rs:127:18
    |
127 |     pub async fn count(&self, status: Option<VersionStatus>) -> Result<i64, AppError> {
    |                  ^^^^^
help: remove the extra argument
    |
279 -             .count(Some(VersionStatus::Available), None)
279 +             .count(Some(VersionStatus::Available))
    |

error[E0061]: this method takes 1 argument but 2 arguments were supplied
   --> src/services/version.rs:283:14
    |
283 |             .count(Some(VersionStatus::Deprecated), None)
    |              ^^^^^                                  ---- unexpected argument #2 of type `std::option::Option<_>`
    |
note: method defined here
   --> src/repositories/version.rs:127:18
    |
127 |     pub async fn count(&self, status: Option<VersionStatus>) -> Result<i64, AppError> {
    |                  ^^^^^
help: remove the extra argument
    |
283 -             .count(Some(VersionStatus::Deprecated), None)
283 +             .count(Some(VersionStatus::Deprecated))
    |

error[E0282]: type annotations needed
   --> src/services/version.rs:308:22
    |
308 |                     .as_ref()
    |                      ^^^^^^
309 |                     .map_or(true, |v| !self.is_newer_version(v, latest_version))
    |                      ------ type must be known at this point
    |
help: try using a fully qualified path to specify the expected types
    |
307 -                 d.os_version
307 +                 <std::string::String as AsRef<T>>::as_ref(&d.os_version)
    |

error[E0277]: the trait bound `fn(State<Arc<...>>, ..., ...) -> ... {register_device}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:39:42
    |
 39 |         .route("/devices/register", post(handlers::register_device))
    |                                     ---- ^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Request<Body>, ...) -> ... {register_device}`
    |                                     |
    |                                     required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-16719919195224405043.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<...>, ..., ..., ...) -> ... {approve_device}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:54:18
    |
 54 |             post(handlers::approve_device),
    |             ---- ^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Path<...>, ..., ...) -> ... {approve_device}`
    |             |
    |             required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-4147378617315986799.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<...>, ..., ..., ...) -> ... {reject_device}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:58:18
    |
 58 |             post(handlers::reject_device),
    |             ---- ^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Path<...>, ..., ...) -> ... {reject_device}`
    |             |
    |             required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-16639911057683451260.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<Arc<AppState>>, ..., ...) -> ... {inject_key}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:73:37
    |
 73 |         .route("/keys/inject", post(handlers::inject_key))
    |                                ---- ^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Request<Body>, Json<...>) -> ... {inject_key}`
    |                                |
    |                                required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-3366736707508439414.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<Arc<...>>, ..., ..., ...) -> ... {update_key}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:75:48
    |
 75 |         .route("/keys/:device_id/update", post(handlers::update_key))
    |                                           ---- ^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Path<String>, ..., ...) -> ... {update_key}`
    |                                           |
    |                                           required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-5680373532076828929.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<...>, ..., ..., ...) -> ... {resolve_threat}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:102:18
    |
102 |             post(handlers::resolve_threat),
    |             ---- ^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Path<...>, ..., ...) -> ... {resolve_threat}`
    |             |
    |             required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-10922688717848923543.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<Arc<...>>, ..., ...) -> ... {create_version}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:142:34
    |
142 |         .route("/versions", post(handlers::create_version))
    |                             ---- ^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Request<Body>, ...) -> ... {create_version}`
    |                             |
    |                             required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-5469019071894458145.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<Arc<...>>, ..., ...) -> ... {create_push_task}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:157:39
    |
157 |         .route("/versions/push", post(handlers::create_push_task))
    |                                  ---- ^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Request<Body>, ...) -> ... {create_push_task}`
    |                                  |
    |                                  required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `post`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:443:1
    |
443 | top_level_handler_fn!(post, POST);
    | ^^^^^^^^^^^^^^^^^^^^^^----^^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `post`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-5147574444615733528.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: the trait bound `fn(State<...>, ..., ..., ...) -> ... {update_version}: Handler<_, _>` is not satisfied
   --> src/api/routes.rs:161:45
    |
161 |         .route("/versions/:version_id", put(handlers::update_version))
    |                                         --- ^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Handler<_, _>` is not implemented for fn item `fn(State<Arc<AppState>>, Path<...>, ..., ...) -> ... {update_version}`
    |                                         |
    |                                         required by a bound introduced by this call
    |
    = note: Consider using `#[axum::debug_handler]` to improve the error message
    = help: the following other types implement trait `Handler<T, S>`:
              `Layered<L, H, T, S>` implements `Handler<T, S>`
              `MethodRouter<S>` implements `Handler<(), S>`
note: required by a bound in `put`
   --> /Users/sm4299/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/axum-0.7.9/src/routing/method_routing.rs:444:1
    |
444 | top_level_handler_fn!(put, PUT);
    | ^^^^^^^^^^^^^^^^^^^^^^---^^^^^^
    | |                     |
    | |                     required by a bound in this function
    | required by this bound in `put`
    = note: the full name for the type has been written to '/Users/sm4299/Downloads/SUNMI-Solutions/SoftPOS/sunbay-softpos-backend/target/debug/deps/sunbay_softpos_backend-4234c1fe5722526f.long-type-10985664445439646191.txt'
    = note: consider using `--verbose` to print the full type name to the console
    = note: this error originates in the macro `top_level_handler_fn` (in Nightly builds, run with -Z macro-backtrace for more info)

Some errors have detailed explanations: E0061, E0277, E0282, E0308, E0382, E0412, E0432, E0433, E0560...
For more information about an error, try `rustc --explain E0061`.
warning: `sunbay-softpos-backend` (lib) generated 34 warnings
error: could not compile `sunbay-softpos-backend` (lib) due to 102 previous errors; 44 warnings emitted
